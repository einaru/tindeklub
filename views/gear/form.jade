extends ../layouts/default

block main
	- var action = "/gear"
	- action += gear.isNew ? "" : "/" + gear._id
	article.gear
		header
			.container
				h1= title
				h2= fmt.str.capitalize(gear.category)
		form(action=action, method="post", enctype="multipart/form-data")
			input(type="hidden", name="category", value=gear.category)
			if (!gear.isNew)
				input(type="hidden", name="_method", value="put")
			.block.light
				.container
					#details
						h2 Details
						div
							label(for="name") Name
							div: input(type="text", name="name", value=gear.name)
						div
							label(for="manufacturer") Manufacturer
							div: input(type="text", name="manufacturer", value=gear.manufacturer)
						div
							label(for="state") State
							div: select(name="state")
								for val in gear.schema.path("state").enumValues
									if val == gear.state
										option(value=val, selected)= fmt.str.capitalize(val)
									else
										option(value=val)= fmt.str.capitalize(val)
						div
							label(for="purcased") Purcased
							div: input(type="text", name="purcased", value=fmt.date.human(gear.purcased))
						div
							label(for="first_used") First used
							div: input(type="text", name="first_used", value=fmt.date.human(gear.first_used))
						div
							label(for="serial_number") Serial number
							div: input(type="text", name="serial_number", value=gear.serial_number)
						div
							label(for="certifications") Certifications
							div: input(type="text", name="certifications", value=gear.certifications)

					#tech-specs
						h2 Tech specs
						for meta, attr in metadata
							div
								label(for=attr)= fmt.str.capitalize(attr)
								div
									- var type = meta.type || "text"
									- var name = "tech_specs[" + attr + "]"
									- var value = gear.isNew ? "" : gear.tech_specs[attr]
									if type == "number"
										input(type=type, name=name, min="0", value=value)
									else
										input(type=type, name=name, value=value)
									if meta.unit
										span.unit(title=meta.unit.name)= meta.unit.symbol

					#images
						h2 Images
						div
							div
								input(type="file", name="images", multiple)

			footer
				.container
					#actions
						if (gear.isNew)
							label(for="n_items")
								| Add
								input(type="number" name="n_items", value="1" min="1")
								| items
						input(type="submit", value="Save")
						a(href=action) Cancel
